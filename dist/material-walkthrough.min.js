!function(e,n){"object"==typeof exports&&"undefined"!=typeof module?module.exports=n():"function"==typeof define&&define.amd?define(n):e.MaterialWalkthrough=n()}(this,function(){"use strict";!function(){function e(e){this.value=e}function n(n){var t,a;function o(t,a){try{var i=n[t](a),l=i.value;l instanceof e?Promise.resolve(l.value).then(function(e){o("next",e)},function(e){o("throw",e)}):r(i.done?"return":"normal",i.value)}catch(e){r("throw",e)}}function r(e,n){switch(e){case"return":t.resolve({value:n,done:!0});break;case"throw":t.reject(n);break;default:t.resolve({value:n,done:!1})}(t=t.next)?o(t.key,t.arg):a=null}this._invoke=function(e,n){return new Promise(function(r,i){var l={key:e,arg:n,resolve:r,reject:i,next:null};a?a=a.next=l:(t=a=l,o(e,n))})},"function"!=typeof n.return&&(this.return=void 0)}"function"==typeof Symbol&&Symbol.asyncIterator&&(n.prototype[Symbol.asyncIterator]=function(){return this}),n.prototype.next=function(e){return this._invoke("next",e)},n.prototype.throw=function(e){return this._invoke("throw",e)},n.prototype.return=function(e){return this._invoke("return",e)}}();var e=function(e,n){if(!(e instanceof n))throw new TypeError("Cannot call a class as a function")},n=function(){function e(e,n){for(var t=0;t<n.length;t++){var a=n[t];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}return function(n,t,a){return t&&e(n.prototype,t),a&&e(n,a),n}}(),t=function(){function t(){e(this,t)}return n(t,null,[{key:"get",value:function(e){return"string"==typeof e?document.querySelector(e):e}},{key:"setStyle",value:function(e,n){Object.keys(n).forEach(function(t){e.style[t]=n[t]})}},{key:"appendTo",value:function(e,n){var t=document.createElement("div");t.innerHTML=n,e.appendChild(t.children[0])}},{key:"removeClass",value:function(e,n){e.classList.remove(n)}},{key:"addClass",value:function(e,n){e.classList.add(n)}}]),t}(),a=function(){function a(){e(this,a)}return n(a,null,[{key:"preventDefault",value:function(e){(e=e||window.event).preventDefault&&e.preventDefault(),e.returnValue=!1}},{key:"preventDefaultForScrollKeys",value:function(e){if(a.keys[e.keyCode])return a.preventDefault(e),!1}},{key:"disable",value:function(){t.setStyle(t.get("html"),{height:"100vh",overflow:"hidden"});var e=a.preventDefault,n=a.preventDefaultForScrollKeys;window.addEventListener&&window.addEventListener("DOMMouseScroll",e,!1),window.onwheel=e,window.onmousewheel=document.onmousewheel=e,window.ontouchmove=e,document.onkeydown=n}},{key:"enable",value:function(){t.setStyle(t.get("html"),{height:"",overflow:"auto"}),window.removeEventListener&&window.removeEventListener("DOMMouseScroll",a.preventDefault,!1),window.onmousewheel=document.onmousewheel=null,window.onwheel=null,window.ontouchmove=null,document.onkeydown=null}}]),a}();function o(e){var n,t=0==(e=""+e).indexOf("#"),a=0==e.indexOf("rgb");if(t&&(n=e.substr(1).match(7==e.length?/(\S{2})/g:/(\S{1})/g)))var o=parseInt(n[0],16),r=parseInt(n[1],16),i=parseInt(n[2],16);if(a&&(n=e.match(/(\d+){3}/g)))o=n[0],r=n[1],i=n[2];if(void 0!==o)return(299*o+587*r+114*i)/1e3}a.keys={37:1,38:1,39:1,40:1,32:1,33:1,34:1},function(e,n){void 0===n&&(n={});var t=n.insertAt;if(e&&"undefined"!=typeof document){var a=document.head||document.getElementsByTagName("head")[0],o=document.createElement("style");o.type="text/css","top"===t&&a.firstChild?a.insertBefore(o,a.firstChild):a.appendChild(o),o.styleSheet?o.styleSheet.cssText=e:o.appendChild(document.createTextNode(e))}}("/**\n * Copyright 2017 Esset Software LTD.\n *\n * Licensed under the Apache License, Version 2.0 (the \"License\");\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n * http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an \"AS IS\" BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\n\n\nbody {\n    margin: 0px; /* Having problems with getClientRects. Webkit apply 8px for maring in body. Reseting body */\n    position: relative; /* FIX FROM ISSUE #30 */\n}\n#walk-bounds {\n    position: absolute;\n    top: 0;\n    left: 0;\n    width: 100vw;\n    height: 100%;\n    z-index: 1000;\n    overflow: hidden;\n    pointer-events: none;\n}\n/* END */\n\n#walk-wrapper {\n    pointer-events: all;\n    transform: translateZ(0);\n    position: absolute;\n    color: white; /* @TODO: Decide the contrast color based on the bright of the main color */\n    z-index: 1000;\n    display: none;\n}\n#walk-wrapper.dark {\n  color: black;\n}\n\n#walk-wrapper.opened {\n    transition: 0.25s;\n}\n\n#walk-wrapper.closed {\n    height: 1000px !important;\n    width: 1000px !important;\n    opacity: 0;\n}\n\n#walk-wrapper.closed #walk-content-wrapper {\n    display: none;\n}\n\n#walk-wrapper:before {\n    content: '';\n    display: block;\n    position: absolute;\n    background: transparent;\n    border: solid 0vw;\n    border-radius: 50%;\n    border-color: inherit;\n    width: inherit;\n    height: inherit;\n    margin-top: 0vw;\n    margin-left: 0vw;\n    opacity: .9;\n    box-sizing: content-box !important;\n    transition: border-width 0.25s ease-in, margin 0.25s ease-in;\n}\n\n#walk-wrapper.opened:before {\n    border-width: 200vw;\n    margin-left: -200vw;\n    margin-top: -200vw;\n}\n\n#walk-wrapper:after {\n    content: ' ';\n    box-sizing: content-box;\n    position: absolute;\n    top: -1px;\n    left: -1px;\n    width: 100%;\n    height: 100%;\n    border: 1px solid white;\n    border-radius: 50%;\n    box-shadow: inset 0px 0px 10px rgba(0,0,0,0.5);\n}\n\n#walk-wrapper #walk-content-wrapper {\n    position: relative;\n    min-width: 200px;\n    width: 33vw;\n    font-family: 'Roboto', sans-serif;\n    font-size: 24px;\n    opacity: 1;\n    transition: 0.25s opacity;\n\n    /* DEFAULT POSITION */\n    top: 100%;\n    left: 100%;\n}\n\n#walk-wrapper:not(.opened) #walk-content-wrapper,\n#walk-wrapper.transiting #walk-content-wrapper {\n    opacity: 0;\n}\n\n#walk-wrapper #walk-action {\n    height: 36px;\n    padding: 0 2rem;\n    margin-top: 10px;\n    background-color: rgba(255, 255, 255, 0.2);\n    border: 0;\n    border-radius: 2px;\n    letter-spacing: 1px;\n    font-size: 15px;\n    font-weight: bold;\n    text-transform: uppercase;\n    color: white;\n    display: inline-block;\n    flex-flow: initial;\n}\n#walk-wrapper.dark #walk-action {\n  color: black;\n  background-color: rgba(0, 0, 0, 0.2);\n}\n\n#walk-wrapper #walk-action:hover {\n    background-color: rgba(255, 255, 255, 0.25);\n}\n#walk-wrapper.dark #walk-action:hover {\n  color: black;\n  background-color: rgba(0, 0, 0, 0.25);\n}\n\n\n/** small rules **/\n#walk-wrapper.opened.small:before {\n    border-width: 320px;\n    margin-left: -320px;\n    margin-top: -320px;\n}\n#walk-wrapper.small #walk-content-wrapper {\n  max-width: 300px;\n}\n\n#walk-wrapper.transiting.small:not(.animations-disabled) {\n    display: none !important;\n}\n\n@media (max-width: 750px) {\n    #walk-wrapper.opened.small:before {\n        border-width: 50vw;\n        margin-left: -50vw;\n        margin-top: -50vw;\n    }\n}\n\n/** animations-disabled rules **/\n#walk-wrapper.animations-disabled,\n#walk-wrapper.animations-disabled:before {\n    transition: 0s;\n}\n\n#walk-wrapper.animations-disabled:before {\n    transition: 0.25s opacity;\n}\n\n#walk-wrapper.opened.animations-disabled:before {\n    opacity: .9;\n}\n\n#walk-wrapper.animations-disabled:before,\n#walk-wrapper.transiting.animations-disabled:before,\n#walk-wrapper.closed.animations-disabled:before,\n#walk-wrapper.closed.animations-disabled {\n    opacity: 0;\n}\n\n/*\nTODO: Make it responsible with layout breakpoints.\n    * The walk border\n    * The content text\n*/\n@media all and (max-width: 768px) {\n    #walk-wrapper #walk-content-wrapper {\n        max-width: 270px;\n        font-size: 18px;\n    }\n}\n",{});var r={MSG:!0,WALK_CONTENT:!0,WALK_CONTENT_TOP:!0,WALK_LOCK:!0,WALK_SCROLL:!0,ALL:!0};function i(e,n){for(var t,a=arguments.length,o=Array(a>2?a-2:0),i=2;i<a;i++)o[i-2]=arguments[i];(r[e]||r.ALL)&&(t=console).log.apply(t,[e+": "+n].concat(o))}var l=function(){function r(){e(this,r)}return n(r,null,[{key:"elementTemplate",value:function(){return r.ELEMENT_TEMPLATE||"<div id='walk-wrapper' class='"+(r.DISABLE_HUGE_ANIMATIONS?"animations-disabled":"")+" "+(r.FORCE_SMALL_BORDER?"small":"")+"'>\n        <div id='walk-content-wrapper'>\n          "+(r.ENABLE_STAGE_COUNTER?r.STAGE_COUNTER_TEMPLATE:"")+"        \n          <div id='walk-content'></div>\n          <button id='walk-action'></button>\n          "+(r.ENABLE_QUIT?r.QUIT_TEMPLATE:"")+"        \n        </div>\n      </div>"}},{key:"_init",value:function(){t.appendTo(t.get("body"),r.elementTemplate()),r._wrapper=t.get("#walk-wrapper"),r._contentWrapper=t.get("#walk-content-wrapper"),r._content=t.get("#walk-content"),r._actionButton=t.get("#walk-action"),r.ENABLE_STAGE_COUNTER&&(r._stageCounterWrapper=t.get("#walk-counter")),r.ENABLE_QUIT&&(r._quitButton=t.get("#walk-quit-button")),r.DISABLE_HUGE_ANIMATIONS&&t.addClass(r._wrapper,"animations-disabled"),r.FORCE_SMALL_BORDER&&t.addClass(r._wrapper,"small"),r.isInitialized=!0}},{key:"_targetIsHidden",value:function(e){if(!e)return!0;var n=e.currentStyle?e.currentStyle.display:getComputedStyle(e,null).display;return!(!e||0!==e.getClientRects().length)||n&&"none"===n}},{key:"_setWalker",value:function(e){var n=t.get(e.target);if(r._targetIsHidden(n))return i("_setWalker","Target "+e.target+" not found or hidden. Skiping to next WalkPoint"),void r._next();if(r.ENABLE_STAGE_COUNTER){r._instance.currentAccesibleStage++;var a=document.querySelector("#walk-stage-step");a&&(a.textContent=r._instance.currentAccesibleStage),(a=document.querySelector("#walk-stage-total"))&&(a.textContent=r._instance.totalAccessibleStages)}i("MSG","-------------------------------------"),i("MSG","Setting a walk to #"+n.id),i("WALK_SETUP","Properties:\n"+JSON.stringify(e,null,2)),r._setupListeners(n,e.container,e.onClose,e),r._locateTarget(n,e.container,function(){r._setProperties(e.content,e.color,e.acceptText),t.setStyle(r._wrapper,{display:"block"}),r._renderFrame(n,e,function(){t.addClass(r._wrapper,"opened"),r._renderContent(n,function(){t.removeClass(r._wrapper,"transiting")}),r._renderContent(n,function(){t.removeClass(r._wrapper,"transiting")})})}),i("MSG","Walk created. Calling onSet() (if exists)"),e.onSet&&e.onSet()}},{key:"_createUpdateHandler",value:function(e,n,t){i("WALK_UPDATE","Creating UpdateHandler for #"+e.id);var a=function(){i("MSG","Updating and rendering"),r._locateTarget(e,n,function(){r._renderFrame(e,t,function(){r._renderContent(e)})})};return a.toString=function(){return"updateHandler -> #"+e.id},a}},{key:"_next",value:function(){!!r._instance.points&&!!r._instance.points[r._instance.currentIndex+1]?(r._instance.currentIndex++,r._setWalker(r._instance.points[r._instance.currentIndex])):r.closeWalker()}},{key:"_setupListeners",value:function(e,n,a,o){r._instance.updateHandler&&r._flushListeners(),r._instance.updateHandler=r._createUpdateHandler(e,n,o),window.addEventListener("resize",r._instance.updateHandler),r._instance.mutationObserver=new MutationObserver(r._instance.updateHandler),r._instance.mutationObserver.observe(document.body,{childList:!0,subtree:!0}),r._actionButton.addEventListener("click",function e(){a&&a(),t.addClass(r._wrapper,"transiting"),setTimeout(function(){r._next()},r.TRANSITION_DURATION),r._actionButton.removeEventListener("click",e)})}},{key:"_flushListeners",value:function(){i("WALK_UPDATER","Flushing handlers\n"+r._instance.updateHandler),r._instance.mutationObserver&&r._instance.mutationObserver.disconnect(),r._instance.mutationObserver=null,window.removeEventListener("resize",r._instance.updateHandler)}},{key:"_setProperties",value:function(e,n,a){var i=n||r.DEFAULT_COLOR;console.log(o(i));var l=o(i);if(127.916==l||122.966==l||126.36==l||134.569==l||(145.93!=l||139.462!=l||142.449!=l)&&l>138.872?t.addClass(r._wrapper,"dark"):t.removeClass(r._wrapper,"dark"),t.setStyle(r._wrapper,{borderColor:i}),r._content.innerHTML=e,r._actionButton.innerHTML=a||r.DEFAULT_ACCEPT_TEXT,!r.FORCE_SMALL_BORDER){var s=t.get('meta[name="theme-color"]');s&&s.setAttribute("content",i)}}},{key:"_position",value:function(e){var n=0,t=0;do{n+=e.offsetLeft,t+=e.offsetTop,e=e.offsetParent}while(null!==e);return{left:n,top:t}}},{key:"_locateTarget",value:function(e,n,t){var a=document.querySelector(n||"body"),o=void 0,l=void 0;"body"===a.tagName.toLowerCase()?(o=document.documentElement.clientHeight,l=Math.max(document.body.scrollHeight,document.documentElement.scrollHeight,document.body.offsetHeight,document.documentElement.offsetHeight,document.body.clientHeight,document.documentElement.clientHeight)):(o=a.clientHeight,l=a.scrollHeight);var s=r._position(a).top,c=l-o,p=r._position(e).top-s-o/2+e.getClientRects()[0].height/2,d=Math.min(p,c);i("WALK_LOCK","Moving Scroll to:",d),i("WALK_LOCK",n+" clientHeight:",o),"body"===a.tagName.toLowerCase()?window.scrollTo(0,d):a.scrollTop=d,t&&t()}},{key:"_renderFrame",value:function(e,n,a){var o=e.getBoundingClientRect(),l=o.height,s=o.width,c=o.left,p=o.top+window.pageYOffset,d=l>s?l:s;d<r.MIN_SIZE&&(d=r.MIN_SIZE),n&&n.holeSize&&(d=n.holeSize),i("WALK_LOCK","Walk hole size "+d+"px"),i("WALK_LOCK","Gutter is "+r.GUTTER);var u={height:d+r.GUTTER+"px",width:d+r.GUTTER+"px",marginLeft:-(d+r.GUTTER)/2+"px",marginTop:-(d+r.GUTTER)/2+"px",left:c+s/2+"px",top:p+l/2+"px"};t.setStyle(r._wrapper,u),i("WALK_LOCK","Positioning \n"+JSON.stringify(u,2)),setTimeout(function(){a()},r.TRANSITION_DURATION/2)}},{key:"_renderContent",value:function(e,n){var a=r._wrapper.getBoundingClientRect(),o=a.left+(r._wrapper.offsetWidth-r.GUTTER)+r._contentWrapper.offsetWidth<window.innerWidth,l=a.left+r.GUTTER-r._contentWrapper.offsetWidth>0,s=a.top-r._contentWrapper.offsetHeight>0,c=a.top+r._contentWrapper.offsetHeight+r._wrapper.offsetHeight<window.innerHeight;i("WALK_CONTENT","itCanBeRenderedInRight: "+o),i("WALK_CONTENT","itCanBeRenderedInLeft: "+l),i("WALK_CONTENT","itCanBeRenderedInTop: "+s),i("WALK_CONTENT","itCanBeRenderedInBottom: "+c);var p="100%",d="100%",u=0,w=0,f="left";o||(p=l?"-"+r._contentWrapper.offsetWidth+"px":"calc(50% - 100px)",f=l?"right":"center",u=l?0:c?"10px":"-10px"),c||(d=s?"-"+r._contentWrapper.offsetHeight+"px":r._wrapper.offsetHeight/2-r._contentWrapper.offsetHeight/2+"px",w=s?0:o?"10px":"-10px"),t.setStyle(r._contentWrapper,{left:p,top:d,textAlign:f,marginTop:u,marginLeft:w});var _=r._contentWrapper.getBoundingClientRect();if(_.left<20||_.left+_.width+20>window.innerWidth){i("WALK_CONTENT","Text would overhang to left or right: will centre ");var g=window.innerWidth/2-_.width/2;w=w+(_.left<20?g-_.left:-(_.left-g))+"px",t.setStyle(r._contentWrapper,{"margin-left":w})}n&&n()}},{key:"walk",value:function(e,n){if(r._instance.points=e,r._instance.currentIndex=0,r._instance.currentAccesibleStage=0,r._instance.onCloseCallback=n,document.querySelector('meta[name="theme-color"]'))r.ORIGINAL_THEME_COLOR=document.querySelector('meta[name="theme-color"]').getAttribute("content");else{r.ORIGINAL_THEME_COLOR=null;var t=document.createElement("meta");t.name="theme-color",t.content="",document.querySelector("head").appendChild(t)}r.ENABLE_STAGE_COUNTER&&r._setupStageCounter(),r.to(e[0])}},{key:"_setupStageCounter",value:function(){i("WALK_CONTENT"," walking content to count valid stages..."),r._instance.totalAccessibleStages=0;var e=0;for(e=0;e<r._instance.points.length;e++){var n=r._instance.points[e].target;i("WALK_CONTENT","checking "+n),r._targetIsHidden(t.get(n))||(i("WALK_CONTENT","target is present "+n),r._instance.totalAccessibleStages++)}}},{key:"to",value:function(e){if(r.CURRENT_DOCUMENT_HEIGHT=document.querySelector("html").offsetHeight,a.disable(),r.isInitialized||r._init(),r.ENABLE_STAGE_COUNTER){var n=document.querySelector("#walk-stage-step");n&&(n.textContent=r._instance.currentAccesibleStage),(n=document.querySelector("#walk-stage-total"))&&(n.textContent=r._instance.totalAccessibleStages)}t.removeClass(r._wrapper,"closed"),r._setWalker(e)}},{key:"closeWalker",value:function(){i("MSG","Closing Walker"),r._instance.currentIndex=0,r._instance.currentAccesibleStage=0,r._instance.points=null,r._instance.onCloseCallback&&r._instance.onCloseCallback(),r._instance.onCloseCallback=null;var e=r._actionButton.cloneNode(!0);r._actionButton.parentNode.replaceChild(e,r._actionButton),r._actionButton=e,r._flushListeners(),a.enable();var n=t.get('meta[name="theme-color"]');n&&n.setAttribute("content",r.ORIGINAL_THEME_COLOR),t.setStyle(r._wrapper,{marginTop:"-500px",marginLeft:"-500px"}),t.addClass(r._wrapper,"closed"),setTimeout(function(){t.setStyle(r._wrapper,{display:"none"}),t.removeClass(r._wrapper,"opened"),t.removeClass(r._wrapper,"transiting"),i("MSG","Walker Closed!")},r.TRANSITION_DURATION)}}]),r}();return l.CURRENT_DOCUMENT_HEIGHT=0,l.ORIGINAL_THEME_COLOR=null,l.DEFAULT_COLOR="#2196F3",l.DEFAULT_ACCEPT_TEXT="Ok",l.TRANSITION_DURATION=500,l.DISABLE_HUGE_ANIMATIONS=!1,l.FORCE_SMALL_BORDER=!1,l.MIN_SIZE=60,l.GUTTER=20,l.ENABLE_QUIT=!1,l.QUIT_TEMPLATE="<a id='walk-quit-button'>Quit tour</a>",l.ENABLE_STAGE_COUNTER=!1,l.STAGE_COUNTER_TEMPLATE="\n    <div id='walk-stage'>\n      <span id='walk-stage-step'>Step</span>\n      <span id='walk-stage-index'></span>\n      <span id='walk-stage-of'>of</span>\n      <span id='walk-stage-total'></span>\n    </div>",l.ELEMENT_TEMPLATE=null,l.isInitialized=!1,l._wrapper=null,l._contentWrapper=null,l._content=null,l._actionButton=null,l._stageCounterWrapper=null,l._quitButton=null,l._instance={updateHandler:null,mutationObserver:null,points:null,currentIndex:null,onCloseCallback:null,totalAccessibleStages:null,currentAccesibleStage:null},l});
